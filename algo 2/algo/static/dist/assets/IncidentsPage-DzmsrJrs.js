import{j as e,B as h,L as f,y,C as u,q as j,s as N,t as v}from"./index-DF6BEUun.js";import{B as d}from"./badge-Bpc-iUD6.js";import{u as w}from"./useTomTomIncidents-BtkwK_z3.js";import{u as T}from"./useSupabaseTraffic-DNZrrX_L.js";import{T as k}from"./triangle-alert-CAQfuelW.js";import{A as L}from"./arrow-left-8Q1IB9i5.js";import{C as I}from"./clock-B6HL2XHe.js";import{M as C}from"./map-pin-s7gZECWs.js";import{I as A}from"./info-C-aJ_sCJ.js";import"./supabaseClient-C32MglI1.js";import"./tslib.es6-CmEaCU22.js";const O=()=>{const{incidents:n,isLoading:m,error:l}=w(),{incidents:c,isLoading:x,error:g}=T(),p=m||x,o=l||g,b=[...(c||[]).map(r=>({...r,reportedAt:r.reported_at,source:"Official Torino (MATO/GTT)"})),...(n||[]).map(r=>({...r,source:"TomTom Live"}))],t=new Map;b.forEach(r=>{var a;const s=`${r.type}-${(a=r.description)==null?void 0:a.substring(0,50)}`.toLowerCase().trim();t.has(s)||t.set(s,r)});const i=Array.from(t.values());return e.jsxs("div",{className:"flex flex-col min-h-screen bg-gray-50 dark:bg-gray-900 p-4 md:p-6",children:[e.jsxs("header",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-800 dark:text-gray-100 flex items-center",children:[e.jsx(k,{className:"h-8 w-8 mr-3 text-indigo-600"}),"Traffic Incidents"]}),e.jsx(h,{asChild:!0,variant:"outline",children:e.jsxs(f,{to:"/torino-dashboard",className:"flex items-center",children:[e.jsx(L,{className:"h-4 w-4 mr-2"}),"Back to Dashboard"]})})]}),p?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx(y,{className:"h-8 w-8 animate-spin text-indigo-600"})}):o?e.jsxs("div",{className:"p-4 bg-red-100 text-red-600 rounded-md",children:["Error loading incidents: ",o,". Using TomTom Real-time API."]}):i.length===0?e.jsx("div",{className:"text-center p-8 text-gray-500",children:"No incidents reported at the moment."}):e.jsx("main",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 flex-1",children:i.map(r=>{const s=r.severity==="High",a=s?"border-l-red-500":"border-l-amber-500";return e.jsxs(u,{className:`overflow-hidden flex flex-col bg-white dark:bg-gray-800 border-t border-b border-r border-l-4 ${a} shadow-sm hover:shadow-lg transition-all duration-300`,children:[e.jsxs(j,{className:"pb-3 bg-gray-50/50 dark:bg-gray-900/20 border-b border-gray-100 dark:border-gray-700/50",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs(d,{variant:"outline",className:`${s?"bg-red-50 text-red-700 border-red-200":"bg-amber-50 text-amber-700 border-amber-200"} border-none font-medium mb-1`,children:[r.severity," SEVERITY"]}),e.jsx(N,{className:"text-lg font-bold text-gray-900 dark:text-gray-100 leading-snug",children:r.type})]}),e.jsxs("span",{className:"text-xs text-gray-400 font-mono flex items-center bg-white dark:bg-gray-800 px-2 py-1 rounded border border-gray-100 dark:border-gray-700",children:[e.jsx(I,{className:"h-3 w-3 mr-1"}),new Date(r.reportedAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]})]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-600 dark:text-gray-400 mt-2 font-medium",children:[e.jsx(C,{className:"h-4 w-4 mr-1.5 text-indigo-500 shrink-0"}),e.jsx("span",{className:"line-clamp-1",children:r.location||"Location pinpointed on map"})]})]}),e.jsxs(v,{className:"pt-4 flex-1 flex flex-col justify-between",children:[e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-semibold text-gray-400 uppercase tracking-wider mb-2",children:"Description"}),e.jsx("div",{className:"text-gray-700 dark:text-gray-300 text-sm leading-relaxed prose prose-sm dark:prose-invert max-w-none [&>p]:mb-2 [&>img]:rounded-md [&>img]:shadow-sm [&>img]:max-h-48 [&>a]:text-blue-600 hover:[&>a]:underline",dangerouslySetInnerHTML:{__html:r.description}})]})}),e.jsxs("div",{className:"mt-5 pt-3 border-t border-gray-100 dark:border-gray-700 flex justify-between items-center text-xs",children:[e.jsxs("div",{className:"flex items-center text-gray-500 dark:text-gray-400 bg-gray-50 dark:bg-gray-800 px-2 py-1 rounded",children:[e.jsx(A,{className:"h-3.5 w-3.5 mr-1.5"}),"Source: ",e.jsx("span",{className:"font-semibold ml-1",children:r.source})]}),e.jsx(d,{variant:"secondary",className:"bg-green-50 text-green-700 border-green-200 text-[10px] px-2",children:r.status})]})]})]},r.id)})})]})};export{O as default};
