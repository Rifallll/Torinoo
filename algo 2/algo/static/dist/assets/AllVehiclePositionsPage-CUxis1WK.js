import{r as n,j as t,B as L,L as v,C as H,q as W,s as K,t as $}from"./index-DF6BEUun.js";import{B as j}from"./badge-Bpc-iUD6.js";import{G as q,f as z,p as J}from"./gtfsRealtimeParser-DzKEFnCZ.js";import{C as Q}from"./car-BUS62zc9.js";import{A as X}from"./arrow-left-8Q1IB9i5.js";import{M as Z}from"./map-pin-s7gZECWs.js";import{A as ee}from"./arrow-right-CIfnmjRj.js";import{T as te}from"./traffic-cone-Bd-mh-Ix.js";import{C as se}from"./clock-B6HL2XHe.js";import{P as ae}from"./plus-BVuh2W-r.js";import{B as C,T as ne}from"./tram-front-yMcRfdku.js";import{I as re}from"./info-C-aJ_sCJ.js";const M=20,Oe=()=>{const[l,h]=n.useState([]),[c,p]=n.useState([]),[w,f]=n.useState(!0),[_,S]=n.useState(null),[O,b]=n.useState(1),I=async()=>{f(!0),S(null);try{const s=[...(await J("/trip_update.bin","/alerts.bin","/vehicle_position.bin")).vehiclePositions].sort((r,i)=>r.occupancy_status==="EMPTY"&&i.occupancy_status!=="EMPTY"?-1:r.occupancy_status!=="EMPTY"&&i.occupancy_status==="EMPTY"?1:0);h(s),p(s.slice(0,M)),console.log("[AllVehiclePositionsPage] Fetched Vehicle Positions:",s)}catch(e){console.error("Failed to fetch or parse GTFS-realtime data:",e),S("Failed to load or parse vehicle position data.")}finally{f(!1)}};n.useEffect(()=>{I();const e=["EMPTY","MANY_SEATS_AVAILABLE","FEW_SEATS_AVAILABLE","STANDING_ROOM_ONLY","CRUSHED_STANDING_ROOM_ONLY","FULL"],s=["RUNNING_SMOOTHLY","STOP_AND_GO","CONGESTION","SEVERE_CONGESTION"],r=setInterval(()=>{h(i=>i.map(a=>{var T,A,y,E;const d=Math.floor(Date.now()/1e3),m=(((T=a.position)==null?void 0:T.latitude)||0)+(Math.random()-.5)*1e-4,u=(((A=a.position)==null?void 0:A.longitude)||0)+(Math.random()-.5)*1e-4;let o=e.indexOf(a.occupancy_status||"EMPTY")+(Math.random()>.7?Math.random()>.5?1:-1:0);o=Math.max(0,Math.min(e.length-1,o));const x=e[o],D=((y=a.position)==null?void 0:y.speed)!==void 0?a.position.speed:30,Y=Math.max(0,Math.min(80,D+(Math.random()-.5)*10)),F=((((E=a.position)==null?void 0:E.bearing)||0)+(Math.random()-.5)*20+360)%360,U=a.congestion_level&&s.includes(a.congestion_level)?a.congestion_level:"RUNNING_SMOOTHLY";let N=s.indexOf(U)+(Math.random()>.7?Math.random()>.5?1:-1:0);N=Math.max(0,Math.min(s.length-1,N));const k=s[N];return{...a,timestamp:d,position:{...a.position,latitude:m,longitude:u,speed:Y,bearing:F},occupancy_status:x,congestion_level:k}}))},15e3);return()=>clearInterval(r)},[]),n.useEffect(()=>{p(l.slice(0,O*M))},[l,O]);const P=n.useCallback(()=>{b(e=>e+1)},[]),R=(e,s)=>{if(e){if(e.includes("B")||e==="101"||e==="68")return t.jsx(C,{className:"h-4 w-4 mr-1"});if(e.includes("T")||e==="4"||e==="15")return t.jsx(ne,{className:"h-4 w-4 mr-1"});if(e.endsWith("U"))return t.jsx(C,{className:"h-4 w-4 mr-1"})}return t.jsx(re,{className:"h-4 w-4 mr-1"})},G=(e,s)=>{if(e&&e!=="UNKNOWN_STOP_STATUS")switch(e){case"IN_TRANSIT_TO":return"In Transit To";case"STOPPED_AT_STATION":return"Stopped at Station";case"IN_VEHICLE_BAY":return"In Vehicle Bay";case"AT_PLATFORM":return"At Platform";default:return e.replace(/_/g," ")}if(s)switch(s){case"EMPTY":return"Empty";case"MANY_SEATS_AVAILABLE":return"Many Seats Available";case"FEW_SEATS_AVAILABLE":return"Few Seats Available";case"STANDING_ROOM_ONLY":return"Standing Room Only";case"CRUSHED_STANDING_ROOM_ONLY":return"Crushed Standing Room Only";case"FULL":return"Full";case"NOT_APPLICABLE":return"Not Applicable";default:return s.replace(/_/g," ")}return"Status Not Available"},B=e=>{switch(e){case"RUNNING_SMOOTHLY":return"bg-green-100 text-green-600 hover:bg-green-100";case"STOP_AND_GO":return"bg-yellow-100 text-yellow-600 hover:bg-yellow-100";case"CONGESTION":return"bg-orange-100 text-orange-600 hover:bg-orange-100";case"SEVERE_CONGESTION":return"bg-red-100 text-red-600 hover:bg-red-100";case"UNKNOWN_CONGESTION_LEVEL":return"bg-gray-100 text-gray-600 hover:bg-gray-100";default:return"bg-gray-100 text-gray-600 hover:bg-gray-100"}},V=e=>{if(!e)return"N/A";switch(e){case"RUNNING_SMOOTHLY":return"Running Smoothly";case"STOP_AND_GO":return"Stop & Go";case"CONGESTION":return"Congestion";case"SEVERE_CONGESTION":return"Severe Congestion";case"UNKNOWN_CONGESTION_LEVEL":return"N/A";default:return"N/A"}};return t.jsxs("div",{className:"flex flex-col min-h-screen bg-gray-50 dark:bg-gray-900 p-4 md:p-6",children:[t.jsxs("header",{className:"flex items-center justify-between mb-6",children:[t.jsxs("h1",{className:"text-3xl font-bold text-gray-800 dark:text-gray-100 flex items-center",children:[t.jsx(Q,{className:"h-8 w-8 mr-3 text-indigo-600"}),"All Real-Time Vehicle Positions"]}),t.jsx(L,{asChild:!0,variant:"outline",children:t.jsxs(v,{to:"/torino-dashboard",className:"flex items-center",children:[t.jsx(X,{className:"h-4 w-4 mr-2"}),"Back to Dashboard"]})})]}),t.jsx("main",{className:"flex-1 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:w?t.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-center py-4 col-span-full",children:"Loading all vehicle positions..."}):_?t.jsx("p",{className:"text-red-500 text-center py-4 col-span-full",children:_}):c.length>0?t.jsxs(t.Fragment,{children:[c.map(e=>{var s,r,i,a,d,m,u,g,o,x;return t.jsxs(H,{className:"overflow-hidden flex flex-col",children:[t.jsxs(W,{className:"pb-3",children:[t.jsxs(K,{className:"text-lg font-semibold flex items-center",children:[R((s=e.trip)==null?void 0:s.route_id),"Route ",((r=e.trip)==null?void 0:r.route_id)||((i=e.vehicle)==null?void 0:i.label)||e.id]}),t.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Trip ID: ",((a=e.trip)==null?void 0:a.trip_id)||"N/A"]})]}),t.jsxs($,{className:"flex-1 flex flex-col justify-between space-y-2",children:[t.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-700 dark:text-gray-300",children:[t.jsxs("span",{className:"flex items-center",children:[t.jsx(Z,{className:"h-4 w-4 mr-2"})," Lat: ",((m=(d=e.position)==null?void 0:d.latitude)==null?void 0:m.toFixed(4))||"N/A",", Lon: ",((g=(u=e.position)==null?void 0:u.longitude)==null?void 0:g.toFixed(4))||"N/A"]}),t.jsx(j,{variant:"secondary",className:"text-xs",children:G(e.current_status,e.occupancy_status)})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-x-4 gap-y-1 text-sm text-gray-600 dark:text-gray-400",children:[t.jsxs("span",{className:"flex items-center",children:[t.jsx(q,{className:"h-4 w-4 mr-2"})," Speed: ",(o=e.position)!=null&&o.speed?`${e.position.speed.toFixed(1)} km/h`:"N/A"]}),t.jsxs("span",{className:"flex items-center",children:[t.jsx(ee,{className:"h-4 w-4 mr-2"})," Bearing: ",(x=e.position)!=null&&x.bearing?`${e.position.bearing.toFixed(0)}Â°`:"N/A"]}),t.jsxs("span",{className:"flex items-center col-span-2",children:[t.jsx(te,{className:"h-4 w-4 mr-2"})," Congestion: ",t.jsx(j,{className:B(e.congestion_level),children:V(e.congestion_level)})]}),t.jsxs("span",{className:"flex items-center col-span-2",children:[t.jsx(se,{className:"h-4 w-4 mr-2"})," Update: ",z(e.timestamp)]})]})]})]},e.id)}),c.length<l.length&&t.jsx("div",{className:"col-span-full text-center mt-4",children:t.jsxs(L,{onClick:P,variant:"outline",className:"flex items-center",children:[t.jsx(ae,{className:"h-4 w-4 mr-2"})," Load More (",l.length-c.length," remaining)"]})})]}):t.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-center py-4 col-span-full",children:"No vehicle positions available."})})]})};export{Oe as default};
