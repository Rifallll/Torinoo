import{r as b,j as e,B as l,L as N,C,q as L,s as T,t as k}from"./index-DF6BEUun.js";import{I as _}from"./input-CJSYcS0U.js";import{u as I}from"./useSupabaseTraffic-DNZrrX_L.js";import{N as c}from"./newspaper-C4D5SDIX.js";import{A as j}from"./arrow-left-8Q1IB9i5.js";import{S}from"./search-B076Z6qi.js";import{C as q}from"./circle-x-BvIIqU8N.js";import"./supabaseClient-C32MglI1.js";import"./tslib.es6-CmEaCU22.js";const P=()=>{const[a,m]=b.useState(""),{trafficChanges:o,isLoading:y,error:f}=I(),d=b.useMemo(()=>{if(!o)return[];if(!a)return o;const s=a.toLowerCase(),r=o.filter(t=>{var i,n,p,h,u,g,w;return(((i=t.description)==null?void 0:i.includes("LINK:"))??!1)&&!((n=t.type)!=null&&n.toLowerCase().includes("public_transport"))&&!((p=t.type)!=null&&p.toLowerCase().includes("debug"))&&!((h=t.responsible_entity)!=null&&h.toLowerCase().includes("gtt"))&&!((u=t.responsible_entity)!=null&&u.toLowerCase().includes("debug"))&&!t.title.toUpperCase().includes("GTT")&&!(t.description||"").includes("Public Transport Alert")&&!(t.description||"").includes("GTT")&&(t.title.toLowerCase().includes(s)||((g=t.description)==null?void 0:g.toLowerCase().includes(s))||((w=t.responsible_entity)==null?void 0:w.toLowerCase().includes(s)))}),x=new Map;return r.forEach(t=>{var n;const i=`${t.title}-${(n=t.description)==null?void 0:n.substring(0,50)}`;x.has(i)||x.set(i,t)}),Array.from(x.values())},[o,a]),v=s=>{const r=(s.title+s.description).toLowerCase();return r.includes("sciopero")||r.includes("strike")?"https://images.unsplash.com/photo-1556740738-b6a63e27c4df?auto=format&fit=crop&q=80&w=400":r.includes("lavori")||r.includes("work")||r.includes("cantiere")?"https://images.unsplash.com/photo-1585829365295-ab7cd400c167?auto=format&fit=crop&q=80&w=400":r.includes("linea")||r.includes("metro")||r.includes("bus")?"https://images.unsplash.com/photo-1544620347-c4fd4a3d5957?auto=format&fit=crop&q=80&w=400":"https://images.unsplash.com/photo-1449965408869-eaa3f722e40d?auto=format&fit=crop&q=80&w=400"};return y?e.jsxs("div",{className:"flex flex-col min-h-screen bg-gray-50 dark:bg-gray-900 p-4 md:p-6 items-center justify-center",children:[e.jsx(c,{className:"h-12 w-12 mr-3 text-indigo-600 animate-pulse"}),e.jsx("h1",{className:"text-3xl font-bold text-gray-800 dark:text-gray-100 mt-4",children:"Loading Latest Traffic News..."})]}):f?e.jsxs("div",{className:"flex flex-col min-h-screen bg-gray-50 dark:bg-gray-900 p-4 md:p-6",children:[e.jsxs("header",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-800 dark:text-gray-100 flex items-center",children:[e.jsx(c,{className:"h-8 w-8 mr-3 text-indigo-600"}),"Torino Traffic News"]}),e.jsx(l,{asChild:!0,variant:"outline",children:e.jsxs(N,{to:"/torino-dashboard",className:"flex items-center",children:[e.jsx(j,{className:"h-4 w-4 mr-2"}),"Back to Dashboard"]})})]}),e.jsx("main",{className:"flex-1 flex items-center justify-center",children:e.jsxs("div",{className:"text-center p-8 bg-red-50 text-red-600 rounded-lg",children:["Error loading news: ",f]})})]}):e.jsxs("div",{className:"flex flex-col min-h-screen bg-gray-50 p-4 md:p-6",children:[e.jsxs("header",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-800 flex items-center",children:[e.jsx(c,{className:"h-8 w-8 mr-3 text-indigo-600"}),"Torino Traffic News (Official)"]}),e.jsx(l,{asChild:!0,variant:"outline",children:e.jsxs(N,{to:"/torino-dashboard",className:"flex items-center",children:[e.jsx(j,{className:"h-4 w-4 mr-2"}),"Back to Dashboard"]})})]}),e.jsx("div",{className:"mb-6 p-4 bg-white dark:bg-gray-800 shadow-lg rounded-xl",children:e.jsx("div",{className:"flex flex-col sm:flex-row gap-4 items-center",children:e.jsxs("div",{className:"relative flex-1 w-full",children:[e.jsx(S,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-500"}),e.jsx(_,{type:"text",placeholder:"Search news...",className:"pl-9 pr-8 w-full h-10 text-base border-gray-300 dark:border-gray-600 focus:ring-indigo-500 focus:border-indigo-500",value:a,onChange:s=>m(s.target.value)}),a&&e.jsx(l,{variant:"ghost",size:"icon",className:"absolute right-1 top-1/2 -translate-y-1/2 h-8 w-8 text-gray-500 hover:bg-transparent",onClick:()=>m(""),children:e.jsx(q,{className:"h-4 w-4"})})]})})}),e.jsx("main",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 flex-1",children:d&&d.length>0?d.map((s,r)=>e.jsxs(C,{className:"overflow-hidden flex flex-col hover:shadow-lg transition-shadow bg-white dark:bg-gray-800",children:[e.jsx("img",{src:v(s),alt:"Traffic News",className:"w-full h-48 object-cover opacity-90 hover:opacity-100 transition-opacity"}),e.jsxs(L,{children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("span",{className:"text-xs font-bold text-indigo-600 uppercase tracking-widest bg-indigo-50 px-2 py-1 rounded",children:s.responsible_entity||"Traffic Update"}),e.jsx("span",{className:"text-xs text-gray-500",children:new Date(s.start_date||Date.now()).toLocaleDateString("en-GB")})]}),e.jsx(T,{className:"text-lg font-bold leading-tight text-gray-900 dark:text-gray-100",children:s.title})]}),e.jsxs(k,{className:"flex-1 flex flex-col justify-between",children:[e.jsx("div",{className:"text-gray-600 dark:text-gray-300 mb-4 text-sm line-clamp-4 prose prose-indigo max-w-none",dangerouslySetInnerHTML:{__html:(s.description||"No description provided.").split("LINK:")[0].trim().replace(/\n/g,"<br/>")}}),(s.description||"").includes("LINK:")&&e.jsx(l,{variant:"outline",className:"w-full mt-auto",asChild:!0,children:e.jsxs("a",{href:(s.description||"").split("LINK:")[1].trim(),target:"_blank",rel:"noopener noreferrer",className:"flex items-center justify-center gap-2",children:["Read on ",s.responsible_entity||"Official Site"," â†’"]})})]})]},s.id||r)):e.jsxs("div",{className:"col-span-full text-center py-12 text-gray-500",children:[e.jsx(c,{className:"h-12 w-12 mx-auto text-gray-300 mb-2"}),e.jsx("p",{children:"No traffic news found matching your search."})]})})]})};export{P as default};
