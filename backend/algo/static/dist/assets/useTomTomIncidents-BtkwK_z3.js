import{r}from"./index-DF6BEUun.js";const b="qggpgZQlhR4vcpylkp8svBR3xF0KNdKB",k="7.40,44.90,7.95,45.28",O=()=>{const[y,l]=r.useState([]),[T,p]=r.useState(!0),[h,m]=r.useState(null),i=async()=>{try{p(!0);const I=encodeURIComponent("{incidents{type,geometry{type,coordinates},properties{id,iconCategory,magnitudeOfDelay,startTime,endTime,from,to,length,delay,events{description,code,iconCategory}}}}"),v=`https://api.tomtom.com/traffic/services/5/incidentDetails?key=${b}&bbox=${k}&fields=${I}&language=en-GB`,n=await fetch(v);if(!n.ok){const s=await n.json().catch(()=>({}));throw new Error(`Failed to fetch TomTom incidents: ${n.statusText}. ${JSON.stringify(s)}`)}const a=await n.json();if(a&&a.incidents){const s=a.incidents.map(g=>{const e=g.properties,f=g.geometry.coordinates,c=e.events&&e.events.length>0?e.events[0]:null;let t="Incident";switch(e.iconCategory){case 1:t="Accident";break;case 6:t="Congestion";break;case 7:t="Lane Closure";break;case 8:t="Road Closure";break;case 9:t="Roadworks";break;case 14:t="Breakdown";break}let d="Medium";const u=e.magnitudeOfDelay;return u>=3?d="High":u<=1&&(d="Low"),{id:e.id,type:t,severity:d,description:(c==null?void 0:c.description)||e.description||"No description available",location:e.from||e.to||"Torino",from:e.from,to:e.to,latitude:f[1],longitude:f[0],reportedAt:e.startTime||new Date().toISOString(),status:"Ongoing"}});console.log("Mapped Incidents:",s),l(s)}else l([]);m(null)}catch(o){console.error("Error fetching TomTom incidents:",o),m(o.message)}finally{p(!1)}};return r.useEffect(()=>{i();const o=setInterval(()=>{console.log("Auto-refreshing TomTom incidents..."),i()},60*1e3);return()=>clearInterval(o)},[]),{incidents:y,isLoading:T,error:h,refetch:i}};export{O as u};
