import{j as t,B as y,L as j,y as N}from"./index-DF6BEUun.js";import{T,d as k,b as d,e as s,a as w,c as a}from"./table-BYPVbGZv.js";import{B as v}from"./badge-Bpc-iUD6.js";import{u as L}from"./useTomTomIncidents-BtkwK_z3.js";import{u as C}from"./useSupabaseTraffic-DNZrrX_L.js";import{T as R}from"./traffic-cone-Bd-mh-Ix.js";import{A as B}from"./arrow-left-8Q1IB9i5.js";import"./supabaseClient-C32MglI1.js";import"./tslib.es6-CmEaCU22.js";const W=()=>{const{incidents:m,isLoading:x,error:g}=L(),{trafficChanges:p,isLoading:h,error:b}=C(),u=x||h,l=g||b,f=[...(p||[]).map(e=>({id:e.id,title:e.title,description:e.description,latitude:e.latitude,longitude:e.longitude,startDate:e.start_date,type:e.type||"roadwork",responsibleEntity:e.responsible_entity||"Muoversi a Torino"})),...(m||[]).map(e=>({id:e.id,title:e.from?`${e.type} at ${e.from}`:e.type,description:e.description,latitude:e.latitude,longitude:e.longitude,startDate:e.reportedAt,type:e.type.toLowerCase().includes("closure")?"closure":e.type.toLowerCase().includes("work")?"roadwork":"reduction",responsibleEntity:"TomTom Live"}))],n=Array.from(new Map(f.map(e=>{var r;return[`${e.title}-${(r=e.description)==null?void 0:r.substring(0,50)}`,e]})).values());return t.jsxs("div",{className:"flex flex-col min-h-screen bg-gray-50 dark:bg-gray-900 p-4 md:p-6",children:[t.jsxs("header",{className:"flex items-center justify-between mb-6",children:[t.jsxs("h1",{className:"text-3xl font-bold text-gray-800 dark:text-gray-100 flex items-center",children:[t.jsx(R,{className:"h-8 w-8 mr-3 text-indigo-600"}),"All Traffic Changes & Roadworks"]}),t.jsx(y,{asChild:!0,variant:"outline",children:t.jsxs(j,{to:"/torino-dashboard",className:"flex items-center",children:[t.jsx(B,{className:"h-4 w-4 mr-2"}),"Back to Dashboard"]})})]}),u?t.jsx("div",{className:"flex-1 flex items-center justify-center",children:t.jsx(N,{className:"h-10 w-10 animate-spin text-indigo-600"})}):l?t.jsxs("div",{className:"p-4 bg-red-100 text-red-600 rounded-md",children:["Error loading traffic changes: ",l,". Using TomTom Real-time API."]}):t.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-md shadow border overflow-hidden",children:t.jsxs(T,{children:[t.jsx(k,{className:"bg-gray-50 dark:bg-gray-900/50",children:t.jsxs(d,{children:[t.jsx(s,{className:"w-[100px]",children:"Status"}),t.jsx(s,{children:"Location"}),t.jsx(s,{className:"hidden md:table-cell",children:"Type"}),t.jsx(s,{className:"hidden lg:table-cell",children:"Description"}),t.jsx(s,{className:"hidden md:table-cell",children:"Reported"})]})}),t.jsx(w,{children:n.length>0?n.map(e=>{const r=e.title.toLowerCase().includes("closure");let i="Lancar",o="bg-emerald-100 text-emerald-800 border-emerald-200";const c=e.severity||(r?"High":"Medium");return c==="High"||r?(i="Macet",o="bg-red-100 text-red-800 border-red-200"):c==="Medium"&&(i="Sedang",o="bg-amber-100 text-amber-800 border-amber-200"),t.jsxs(d,{className:"group hover:bg-gray-50 dark:hover:bg-gray-800/50 transition-colors border-b border-gray-100 dark:border-gray-800",children:[t.jsx(a,{children:t.jsx(v,{variant:"outline",className:`${o} font-semibold shadow-sm`,children:i})}),t.jsxs(a,{className:"font-semibold text-gray-900 dark:text-gray-100",children:[e.title.replace(/^(Road Closure|Roadworks|Road Work|Works) (at|in|on) /i,""),t.jsx("div",{className:"md:hidden text-xs text-gray-500 mt-1 font-normal line-clamp-1",children:e.description})]}),t.jsx(a,{className:"hidden md:table-cell",children:t.jsx("span",{className:"capitalize text-sm text-gray-600 dark:text-gray-400",children:e.type||"Incident"})}),t.jsx(a,{className:"hidden lg:table-cell text-gray-600 dark:text-gray-400 max-w-md truncate text-sm",children:e.description}),t.jsx(a,{className:"hidden md:table-cell text-gray-500 text-xs whitespace-nowrap",children:e.startDate?new Date(e.startDate).toLocaleString(void 0,{hour:"2-digit",minute:"2-digit"}):"Now"})]},e.id)}):t.jsx(d,{children:t.jsx(a,{colSpan:5,className:"h-24 text-center text-gray-500",children:"No active traffic changes reported in Torino."})})})]})})]})};export{W as default};
